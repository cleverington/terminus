#!/usr/bin/env php
<?php

/**
 * This script runs Terminus. It does the following:
 *   - Includes the Composer autoload file
 *   - Starts a container with the input, output, application, and configuration objects
 *   - Starts a runner instance and runs the command
 *   - Exits with a status code
 */

$phar_path = \Phar::running(true);
if ($phar_path) {
    include_once "$phar_path/vendor/autoload.php";
} else {
    if (file_exists(__DIR__ . '/../vendor/autoload.php')) {
        include_once __DIR__ . '/../vendor/autoload.php';
    } elseif (file_exists(__DIR__ . '/../../../autoload.php')) {
        include_once __DIR__ . '/../../../autoload.php';
    }
}

use Pantheon\Terminus\Config;
use Pantheon\Terminus\Terminus;
use Symfony\Component\Console\Input\ArgvInput;
use Symfony\Component\Console\Output\ConsoleOutput;

// Create the input and output objects for Terminus to run against.
$input = new ArgvInput($_SERVER['argv']);
$output = new ConsoleOutput();
// Create a config object.
$config = new Config();

// Running Terminus
// @TODO: Figure out if and why we need to pass input/output twice and define what happens if we
// use different objects for each call.
$terminus = new Terminus($config, $input, $output);
$status_code = $terminus->run($input, $output);
exit($status_code);
